# Consensus

## Instructions

    0. Build a 5 node clustered network (in any language).
    1. Write your own consensus algorithm
    (that handles election of a new leader when the old one dies / is unavailable)

samuel@offscale.io

## Service definition

Found in the protofile [consensus.proto](consensus.proto). Implemented RAFT spec found [here](https://raft.github.io/raft.pdf) section 5.

Code autogenerated using protoc (see [gen-go.sh](gen-go.sh))

## Running the service

To be run in 5 different terminals

```sh
make run-1
make run-2
make run-3
make run-4
make run-5
```

## Assumptions and issues

- not enough time for unit tests
- assume the cluster is always 5 nodes, extending the cluster size should be handled in runtime
- a more elegant solution could be done by using channels instead of mutexes
- had a problem making my containers talk to each other using docker-compose, so I decided to just run each program with different environment variables
- due to the fixed size of the cluster, a new leader will never  be elected if there are less than 4 nodes running; fixable by adding/removing servers during runtime

## Dependencies

```sh
dep ensure
```

## Does it work?

Presumably yes - from manual testing but I'm sure it has its flaws

1. Run all 5 services
2. Kill the leader (by default is server-1 due to its lowest election timeout)
3. Wait a few seconds for the next leader to be elected and all services will start receiving keep alives from the new leader
4. Run the killed service, it will become a follower
5. kill the new leader and wait again
6. a new leader will be elected
